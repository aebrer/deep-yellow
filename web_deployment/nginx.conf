# Nginx configuration for Godot HTML5 export with threading support
#
# Add this location block to your nginx server configuration.
#
# Example usage in /etc/nginx/sites-available/yoursite:
#
# server {
#     listen 80;
#     server_name yoursite.com;
#     root /var/www/html;
#
#     # Include this block for the Godot game location
#     location /backrooms/ {
#         # ... copy contents below ...
#     }
# }

location /backrooms/ {
    # Path to your deployed build/web/ directory
    alias /var/www/backrooms/;
    index index.html;

    # REQUIRED: Headers for SharedArrayBuffer (Godot threading)
    add_header Cross-Origin-Opener-Policy "same-origin" always;
    add_header Cross-Origin-Embedder-Policy "require-corp" always;

    # Optional: Cache control for better performance
    location ~ \.(wasm|pck)$ {
        add_header Cross-Origin-Opener-Policy "same-origin" always;
        add_header Cross-Origin-Embedder-Policy "require-corp" always;
        add_header Cache-Control "public, max-age=31536000, immutable";
        expires 1y;
    }

    location ~ \.(html|js)$ {
        add_header Cross-Origin-Opener-Policy "same-origin" always;
        add_header Cross-Origin-Embedder-Policy "require-corp" always;
        add_header Cache-Control "public, max-age=3600, must-revalidate";
    }

    # Optional: MIME types
    types {
        application/wasm wasm;
        application/octet-stream pck;
    }

    # Optional: Gzip compression (if not enabled globally)
    gzip on;
    gzip_types text/html text/css application/javascript application/wasm;
    gzip_vary on;
    gzip_min_length 1024;
}
